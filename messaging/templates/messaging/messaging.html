{% extends "base.html" %}
{% load static %}

{% block extracss%}
    <link rel="stylesheet" href="{% static 'css/messaging.css' %}">
{% endblock %}

{% block extra_title %} - Messages {% endblock %}


{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-4"></div>
        <div class="col-4">
            <h1>My messages ({{ message_count }})</h1>
            <hr>
        </div>
        <div class="col-4"></div>
    </div>
</div>
<section>
    <div class="container-fluid">
        <div class="row">
            <div class="col-1"></div>
            <div class="col-10">
                {% for m in message %}
                {% if m.send_to == user.username %}
                <a href="{% url 'mark_read' m.id %}">
                    <div class="row message-row {% if m.read == False %}message-row-unread {%else %}message-row-read{% endif %}" id="open-message-{{ m.id }}">
                        <div class="col-3">{{ m.name }}</div>
                        <div class="col-5">{{ m.subject }}</div>
                        <!-- <div class="col-1"></div> -->
                        <div class="col-2">{{ m.day_sent }}</div>
                        <div class="col-2"> {{ m.time_sent }}</div>
                    </div>
                </a>
                <div class="row message-show" id="message-{{ m.id }}">
                    <div class="col-2"></div>
                    <div class="col-3 message-content">
                        <h4>Contact</h4>
                        <hr>
                        <div class="contact-details">
                            <p><i class="fa-solid fa-phone"></i> {{ m.Phone }}</p>
                            <p><i class="fa-solid fa-envelope"></i> {{ m.email }}</p>
                        </div>
                    </div>
                    <div class="col-4 message-content">
                        <h4>Message</h4>
                        <hr>
                        <div class="delete-container" >
                            <i class="fa-regular fa-trash-can" onclick="deleteConfirm{{ m.id }}()"></i>
                            <div id="delete-message-{{ m.id }}" class="delete-message shadow" style="display: none;">
                                <p>
                                    Are you sure you want to delete this message?
                                </p>
                                <button class="btn btn-btn"><a href="{% url 'delete_message' m.id %}">Yes</a></button>
                                <button class="btn btn-btn" onclick="closeDeleteConf{{ m.id }}()">Cancel</button>
                            </div>
                        </div>
                        {{ m.message }}
                    </div>
                    <div class="col-3"></div>
                </div>
                <div class="row">
                    <div class="col-5"></div>
                    <div class="col-2">
                    </div>
                    <div class="col-5"></div>
                </div>
                <!-- <div id="delete-message" class="shadow">
                    <p>
                        Are you sure you want to delete this message?
                    </p>
                    <button class="btn btn-btn"><a href="{% url 'delete_message' m.id %}">Yes</a></button>
                    <button class="btn btn-btn" onclick="closeDeleteConf()">Cancel</button>
                </div> -->
                {% endif %}
                {% endfor %}
            </div>
            <div class="col-1"></div>
        </div>
    </div>
</section>
{% endblock %}
{% block postloadjs %}
{% for m in message %}
<script>
    let message{{ m.id }} = document.getElementById('open-message-{{ m.id }}')
    let messageContent{{ m.id }} = document.getElementById('message-{{ m.id }}')

    function openMessage{{ m.id }}(){
        messageContent{{ m.id }}.style.display = "flex"
        message{{ m.id }}.style.fontWeight = '200'
        message{{ m.id }}.style.backgroundColor = 'var(--light-opaque)'
    }

    function closeMessage{{ m.id }}(){
        messageContent{{ m.id }}.style.display = "none"
    }
    
    message{{ m.id }}.addEventListener('click', openMessage{{ m.id }})
    messageContent{{ m.id }}.addEventListener('click', closeMessage{{ m.id }})
    
</script>


<!-- function to display delete message -->
<script>
    let deleteBox{{ m.id }} = document.getElementById('delete-message-{{ m.id }}');
    
    function deleteConfirm{{ m.id }}(){
        deleteBox{{ m.id }}.style.display = 'block'
    };

    function closeDeleteConf{{ m.id }}(){
        deleteBox{{ m.id }}.style.display = 'none'
    };

</script>
{% endfor %}

{% endblock %}